## 쿠키
* #### Cookie
    * 요청에서 사용됨
    * 클라이언트가 서버에게 이전에 받았던 쿠키를 되돌려 보내는 역할을 함.
    * 이 헤더를 통해 서버는 클라이언트를 식별하고 세션 상태를 유지할 수 있음.

#### 쿠키를 사용하지 않는 경우
HTTP는 상태를 유지하지 않는 무상태 프로토콜(stateless)프로토콜이기 때문에, 쿠키 없이는 사용자의 이전 활동을 알 수 없다. 즉, 사용자의 상태를 고려하지 않으므로
로그인 상태나, 장바구니 상태 등을 유지할 수 없는 문제가 발생한다.
이뿐만 아니라 상태 정보를 매번 다른 방법으로 전달해야하기 때문에 처리 시간이 늘어나서 웹사이트의 성능 저하가 발생할 수 있다.

따라서, 쿠키의 사용은 웹에서 상태 유지, 사용자 경험 개선, 보안 등 다양한 목적으로 널리 사용된다.


*참고* HTTP는 무상태(Stateless) 프로토콜이다. 무상태 프로톨이라는 것은 HTTP가 클라이언트와 서버 간의 이전 요청이나 응답에 대한 정보를기억하지 않다는 것을 의미한다.



## Set-Cookie 헤더
* #### Set-Cookie
    * 응답에서 사용됨
    * 서버가 클라이언트의 웹 브라우저에게 쿠키를 생성하고 저장하라고 지시할 때 사용된다.
    * 클라이언트는 이 헤더를 받은 후 지정된 쿠키를 저장하고, 이후 해당 서버로의 모든 요청에 이 쿠키를 'Cookie' 헤더에 담아 전송한다.

### set-cookie의 구성
* 예) set-cookie:sessionId=abcde1234; expires=Sat,28-Oct-2023 00:00:00 GMT; path=/; domain=.google.com; Secure
* 쿠키 정보는 항상 서버에 전송된다.
    * 즉, 클라이언트가 요청을 할 때마다 해당 도메인에 설정된 쿠키 정보가 자동으로 HTTP 헤더에 포함되어 서버로 전송된다는 의미이다.
    * 서버에 전송하지 않고, 웹 브라우저 내부에 데이터를 저장하고 싶으면 웹 스토리지를 참고할 것(localStorage, sessionStorage)


#### set-cookie 생명주기
* Set-Cookie: expires=Sat,28-Oct-2023 00:00:00 GMT
    * 만료일이 지나면 쿠키가 삭제
* Set-Cookie: max-age=3600(3600초)
    * 0이나 음수를 지정하면 쿠키 삭제
* 세션 쿠키: 만료 날짜를 생략하면 브라우저 종료시 까지만 유지
* 영속 쿠키: 만료 날짜를 입력하면 해당 날짜까지 유지

#### set-cookie domain 속성
* 명시한 경우와 명시되지 않은 경우로 분류
* 명시한 경우
    * Domain 속성은 쿠키가 어떤 도메인에 대해 유효한지를 지정한다.
    * 아래와 같이 도메인을 명시 했을 경우 해당 도메인과 그 하위 도메인에 대한 요청을 할 때만 쿠키를 서버에 전송한다.
    * domain =.google.com
* 명시하지 않은 경우
    * 쿠키를 생성한 도메인에 대해서만 유효하고, 하위 도메인에서 유효하지 않는다.
* 쿠키에는 사용자의 보민감한 정보를 다룰 수 있기 때문에 범위를 잘 고려해서 선택해야한다.

#### set-cookie Path 속성
* Path는 쿠키가 유효한 URL 경로를 지정하는 속성이다.
* 즉, 브라우저는 path에 지정된 경로와 그 하위 경로에 대한 HTTP 요청을 할 때만 쿠키를 서버에 전송한다.
* 명시적으로 설정
    * 예) path=/home  - 지정
    * /home - 지정 경로이므로 쿠키 접근 가능
    * /home/level1  -> 지정 경로 /home의 하위 경로이므로 쿠키 접근 가능
    * /home/level1/level2 -> 지정 경로 /home의 하위 경로이므로 쿠키 접근 가능
    * /hello -> 지정 경로의 하위 경로도 아닌 아예 다른 경로이므로 접근 불가능


#### set-cookie 보안
* 쿠키의 보안 관련 헤더에는 Secure, HttpOnly, SameSite가 있다.
* Secure 속성
    * 원래 쿠키는 http, https를 구분하지 않고 전송한다.
    * Secure 속성을 적용하면, https에만 쿠키를 전송할 수 있도록 설정한다
* HttpOnly 속성
    * JavaScript와 같은 클라이언트 스크립트에서 쿠키에 접근할 수 없도록 제한한다.
        * 즉, 쿠키는 Http 또는 https 프로토콜을 통한 서버와의 요청/응답 통신에만 사용할 수 있도록 하며, JavaScript의 document.cookie와 같은 API를 통해서는 읽거나 쓸 수 없다는 것을 의미한다.
    * 이는 크로스 사이트 스크립팅(XSS)공격을 어렵게 만든다.
      * 참고 크로스사이트 스크립트(XSS)란? 웹 애플리케이션에서 많이 발생하는 보안 취약점 중 하나이다. XSS 공격은 공격자가 웹 사이트에 악성 스크립트를 삽입하는 방식으로 이루어진다. 
      이 악성 스크립트는 다른 사용자의 브라우저에서 실행되어 개인 정보를 탈취하거나 다른 보안 위협을 초래한다.
      * ##### XSS 유형
        * Stored XSS
        * Reflected XSS
        * DOM-based XSS
* SameSite
  * 요청 도메인(GET)과 쿠키에 설정된 쿠키에 설정된 도메인이 같은 경우에만 쿠키를 전송하도록 하는 속성
  * 크로스 사이트 요청 위조(XSRF)공격을 방지하기 위해 사용된다.
    * 참고 XSRF란? 웹 보안 공격의 한 종류로서, 공격자가 사용자의 신원을 빌려 웹 애플리케이션에 무단으로 요청을 보내는 공격이다.
      * 이 공격은 사용자가 로그인한 상태에서 이루어질 때 가장 위험하고, 공격자는 사용자의 데이터를 수정하거나 민감한 작없을 수행할 수 있다.
  * SameSite 속성에는 세 가지 옵션 값이 있음
    * SameSite = Strict : 쿠키가 같은 사이트에서만 전송될 것임을 뜻한다. 즉, 쿠키가 설정된 도메인 외부에서 발생하는 요청에는 쿠키가 포함되지 않는다.
      * 단, 사용자가 외부 사이트에서 현재 사이트로 링크를 통해 접근하는 경우에도 쿠키가 전송되지 않기 때문에, 보안성은 높지만 사용성이 제한된다.
    * SameSite = Lax : 쿠키가 같은 사이트에서 발생한 요청뿐만 아니라 다른 도메인의 일부 안전한 상위 레벨 요청에서도 전송될 수 있다.
      * Strict보다 상대적으로 느슨하며, 보안성 유지와 사용성이 높음
    * SameSite = None : 쿠키가 모든 상황에서 전송될 수 있음을 지시한다. 이 설정은 주로 위에서 설명한 'Secure'속성도 함께 설정해서 쿠키가 HTTPS를 통해서만 정송하도록 한다.
      * 단, 크로스-사이트 요청에서도 쿠키가 전송되기 때문에 보안 위험이 높이질 수 있다.